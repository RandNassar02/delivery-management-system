<div class="container mt-5">
  <h2 class="mb-4">ğŸ›’ Orders</h2>

  <div
    *ngFor="let order of filteredOrders"
    class="order-card card p-4 mb-4 shadow-sm"
  >
    <div
      class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2"
    >
      <div>
        <h5 class="mb-1">ğŸ“¦ Order #{{ order.id }}</h5>
        <small class="text-muted"
          >ğŸ—“ï¸ {{ order.date | date : "mediumDate" }}</small
        >
      </div>
      <div class="d-flex align-items-center gap-2">
        <span class="badge bg-secondary">
          <span *ngIf="order.driverId === 0">
            <i class="fas fa-user-slash"></i> No Driver Assigned</span
          >
          <span *ngIf="order.driverId !== 0"
            ><i class="fas fa-user-check"></i>
            {{ getDriverById(order.driverId)?.name }}</span
          >
        </span>

        <span class="badge bg-secondary">
          <span *ngIf="order.paymentStatus === 'paid'">
            <i class="fas fa-check-circle"></i> Paid</span
          >
          <span *ngIf="order.paymentStatus === 'unpaid'"
            ><i class="fas fa-hourglass-half"></i> Unpaid</span
          >
        </span>

        <span
          class="badge"
          [ngClass]="getDeliveryStatusClass(order.deliveryStatus)"
        >
          {{ order.deliveryStatus.replace("_", " ") }}
        </span>
      </div>
    </div>

    <div *ngIf="getCustomerById(order.customerId) as customer" class="mb-3">
      <h6>ğŸ‘¤ Customer Info</h6>
      <p class="mb-1"><strong>Name:</strong> {{ customer.name }}</p>
      <p class="mb-1"><strong>Email:</strong> {{ customer.email }}</p>
      <p class="mb-1"><strong>Phone:</strong> {{ customer.phone }}</p>
      <p class="mb-0"><strong>Address:</strong> {{ customer.address }}</p>
    </div>

    <div class="mb-3">
      <label><strong>Update Delivery Status:</strong></label>
      <select
        class="form-select w-auto d-inline-block ms-2"
        [(ngModel)]="order.deliveryStatus"
        (change)="updateDeliveryStatus(order)"
      >
        <option *ngFor="let status of deliveryStatusOptions" [value]="status">
          {{ status }}
        </option>
      </select>
    </div>

    <div class="mb-3">
      <label><strong>Assign Driver:</strong></label>
      <select
        id="driverSelect{{ order.id }}"
        class="form-select w-auto d-inline-block ms-2"
        [(ngModel)]="order.driverId"
        (change)="updateDeliveryStatus(order)"
      >
        <option [value]="0">-- Select Driver --</option>

        <option *ngFor="let driver of drivers" [value]="driver.id">
          {{ driver.name }} ({{ driver.vehicleType }})
        </option>
      </select>

      <small class="d-block mt-1"
        >Current Driver:
        <span *ngIf="order.driverId === 0">Unknown driver</span>
        <samp *ngIf="order.driverId !== 0">
          {{ getDriverById(order.driverId)?.name }} ({{
            getDriverById(order.driverId)?.vehicleType
          }})
        </samp>
      </small>
    </div>

    <div>
      <h6>ğŸŒ¿ Ordered Plants</h6>
      <div class="row">
        <div
          *ngFor="let plant of order.plant"
          class="col-md-4 col-sm-6 mb-3 d-flex align-items-start"
        >
          <img
            [src]="plant.image"
            alt="{{ plant.name }}"
            class="me-3 rounded"
            width="60"
            height="60"
          />
          <div>
            <p class="mb-1">
              <strong>{{ plant.name }}</strong>
            </p>
            <span>
              {{ plant.price }} JD Ã— {{ plant.quantity }} =
              <strong>{{ plant.price * plant.quantity }} JD</strong>
            </span>
          </div>
        </div>
      </div>

      <div class="mt-2 text-end">
        <strong>ğŸ’° Total for this order:</strong>
        {{ getTotalAmount(order) }} JD
      </div>
    </div>
  </div>
</div>
